### 1.ARM处理器与中断

## 1.1 CPU的内部结构？
CPU的内部结构大致可以分为？
- 控制单元（指令寄存器、指令译码器、操作控制器）
- 运算单元（算数逻辑单元）
- 存储单元（专用寄存器和通用寄存器）
- 时钟

## 1.2 CPU跟内存、虚拟内存、硬盘的关系
- CPU要调用的程序和数据来自硬盘，但是CPU又不能直接读写硬盘上的系统、程序和数据，所以必须先将硬盘的内容存储在内存中，才能被CPU读写
- 内存是一个中转站，对计算机的运行速度有较大的影响
- 当系统需要的内存空间大于实际的物理内存空间时，就需要用到虚拟内存。虚拟内存可以将部分硬盘空间模拟成内存空间，将暂时不运行的程序和不使用的数据存储到硬盘上，需要时再将其存储到内存上。

## 1.3 ARM结构处理器可以分为哪几类？

- 嵌入式微处理器
	- 由通用计算机的CPU演变而来，位数在32位以上，具有较高的性能
- 嵌入式微控制器
	- 又成单片机，一般以某一种微处理器内核为核心，芯片内部集成ROM、RAM、总线、定时/计数器、I/O、A/D等各种必要的功能和外设
- 嵌入式DSP
	- 嵌入式数字信号处理器，硬件结构和指令进行特殊设计，非常擅长高速实现各种数字信号处理运算（如数字滤波、频谱分析）

## 1.4 嵌入式微处理器和DSP有什么区别？

- 微处理器偏控制、DSP偏运算
- 微处理器外围接口丰富，标准化、通用性、功耗控制等做的更好，适用于消费电子、家用电器等控制领域
- DSP对系统结构和指令做了优化，能进行大量数据的快速计算，适用于音视频处理等领域

## 1.5 ARM处理器有哪些工作状态？ARM指令和Thumb指令有什么区别？
- ARM处理器共有ARM、Thumb/Thumb-2、调试三种状态
- ARM指令是32位，较全面；Thumb指令是16位，较精简
- Thumb-2，Thumb-2状态兼容16位和32位指令，具有Thumb-2计数的ARM处理器无需在ARM和Thumb-2状态之间切换
- 调试状态，处理器处于停机调试

## 1.6 RISC精简指令集计算机和CISC复杂指令集计算机的区别
- RISC控制器多采用硬件连线控制方式，以期更快的执行速度；而CISC控制器绝大多数采用微程序控制方式
- RISC只有加载和存储指令可以访问内存，数据处理指令只对寄存器的内容操作，为了加速程序的运算，RISC会设置多组寄存器，并指定特殊用途的寄存器，因此通用寄存器数量较CISC多。CISC架构允许数据处理指令对内存进行操作，因此需要的寄存器数量比较少。
- RISC大多数是在一个时钟周期内完成，且指令长度统一、数量少；而CISC的复杂指令通过CPU内的微码来完成，需要多个时钟周期，而指令长度不一、数量多
- RISC在实现一个功能的时候，需要的指令数目多，编译器设计就更复杂；CISC的指令丰富，它的编译器可以少做很多事
- RISC较CISC更容易实现指令流水线，因为其指令大多在一个时钟周期内完成。

## 1.7 ARM内部传输数据的总线有哪些？
ARM内部传输数据采用ARMA总线，共4个版本
- AMBA1：ASB、APB
- AMBA2：AHB、APB
- AMBA3：AHB、AXI、ATB、APB
- AMBA4：AXI、ATB、ACE、APB

## 1.8 中断是嵌入式系统中重要的组成部分，这导致了很多编译开发商提供了一种扩展：让标准C支持中断。具体表现是，产生了一新的关键字_interrupt，下面的代码就是使用了_interrupt关键字去定义了一个中断服务子程序ISR，这段代码有什么问题
```c
__interrupt double compute_area(double radius){
	double area = PI * radius * radius;
	printf("Area = %f", area);
	return area;
}
```

- 对于单片机来说，ISR不能传递参数
- 对于单片机来说，ISR不能有返回值
- 在许多的处理器/编译器中，浮点运算一般都是不可重入的。此外，ISR应该是短而有效率的，在ISR中做浮点运算是不明智的。
- 与第三点一样，printf()经常有重入和性能问题。
- 重入一般可以理解为一个函数在同时多次调用，例如操作系统在进程调度过程中，或者单片机、处理器等中断的时候会发生重入的现象。以下情况之一的多数是不可重入函数：
	- 使用了静态数据结构
	- 调用了malloc或free
	- 调用了标准I/O函数，标准IO库很多实现都以不可重入的方式使用全局数据结构
	- 进行浮点运算。许多的处理器/编译器中，浮点一般都是不可重入的，浮点运算大多使用协处理器或者软件模拟来实现

## 1.9 简述处理器中断处理的过程

处理器在中断处理的过程中，一般分为以下几个步骤：
- 中断请求
- 中断响应
- 保护现场
- 中断服务
- 恢复现场
- 中断返回

## 1.10 保护现场、恢复现场的过程？

- 保护现场
	- 中断进栈：首先将r0-r7快速中断或r0-r12其他中断push进堆栈中保存，并将堆栈指针保存在对应中断模式的R13（SP）中
	- 保存下一条指令：把即将执行的下一条指令（PC-4）的地址保存到对应中断模式的R14（LR）中；把CPSR的值保存到对应中断模式的SPSR中，以实现对处理器当前状态、中断屏蔽及各标志位的保护
	- 设置CPSR的相应位：设置CPSR的相应位：设置CPSR[4:0]的5位以相应的工作模式；CPSR[5] = 0 切换到ARM状态；设置CPSR[7] = 1禁止IRQ中断；如果进入复位模式或FIQ模式，还要设置CPSR[6] = 1 以禁止FIQ中断
	- 执行中断程序：给程序计数器PC强制赋值，转入中断向量，执行相应的中断服务程序
- 恢复现场
	- 将原来保存在堆栈的R0-R12或R0-R7 POP出栈，赋值给相应的寄存器
	- 将LR的值赋值给PC，将SPSR的值赋值给CPSR中，恢复被中断的程序状态

## 1.11 复位中断与其他中断有什么不同？

- 当中断产生后，复位中断立即中止当前指令的执行，其余情况都是当处理器完成当前指令后，再去响应中断
- 如果是复位中断，系统自动从0x00000000（8个0）开始重新执行程序，无需中断返回

## 1.12 什么是中断向量？什么是中断嵌套？
- 中断向量：中断服务子程序的入口地址
- 中断嵌套：中断系统正在执行一个中断服务程序时，有另一个优先级更高的中断源提出请求，这时会暂停当前正在执行的级别较低的中断源的服务程序，处理级别更高的中断源。处理完毕后再返回到被中断了的中断服务程序。

## 1.13 外部中断请求IRQ和快速中断请求FIQ的异常向量地址分别为？


0x0000 0018,0x0000 001C

## 1.14 中断的优缺点

- 优点：实现CPU和I/O设备的并行，提高CPU的利用率和系统的性能
- 缺点：中断处理过程需要保护现场、恢复现场，整个过程需要一定的时间和空间开销。如果中断的频率太高，会降低系统的性能

## 1.15 中断服务程序能不能有参数和返回值？

- 在单片机裸机程序中，中断服务既不能有参数，也不能有返回值
- 但是在带操作系统的嵌入式系统中，中断服务程序可以有参数，也可以有返回值
